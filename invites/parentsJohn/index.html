<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Einladung — Christiane & John</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
    :root {
      --bg-overlay: rgba(255,255,255,0.60);
      --accent: #0066cc;
      --radius: 12px;
    }

    html,body{margin:0;padding:0;font-family:Inter,Arial,sans-serif;background:#fff;color:#222}

    .page{
      display:flex;align-items:center;justify-content:center;
      min-height:100vh;padding:16px;
    }

    .overlay {
      background: var(--bg-overlay);
      background-image: url("save-the-date.png");
      background-size: cover;
      background-position: center;
      max-width: 350px;
      width:100%;
      aspect-ratio: 9/16;
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      text-align:center;
      display:grid;
      align-content:center;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      transition: transform 240ms ease, opacity 240ms ease;
    }

    h1 {
      font-family: 'Great Vibes', cursive;
      font-weight:400;
      font-size: clamp(1.9rem,5vw,2.6rem);
      margin:0;
      color:#222;
    }

    .subtitle {
      font-weight:400;
      font-size: clamp(1.1rem,3.5vw,1.5rem);
      margin-bottom:0.2rem;
    }

    .section {
      font-size: clamp(0.75rem,2.6vw,0.9rem);
      line-height:1.3;
      margin-block:0.3rem;
    }

    .small { font-size: clamp(0.65rem,2.3vw,0.75rem); line-height:1.2; }

    .rsvp-button {
      display:inline-block;
      padding:12px 18px;
      background:var(--accent);
      color:#fff;
      border-radius:8px;
      cursor:pointer;
      border:0;
      font-weight:600;
      transition:transform 150ms ease,box-shadow 150ms ease;
    }

    .rsvp-button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,102,204,0.18);}
    .rsvp-button:focus{outline:3px solid rgba(0,102,204,0.14);outline-offset:3px;}
    a.link{color:var(--accent);text-decoration:underline;}

    /* Modal */
    .modal{
      display:none;
      position:fixed;top:0;left:0;width:100%;height:100%;
      background: rgba(0,0,0,0.45);
      align-items:center;justify-content:center;
      padding:16px;
      overflow-y:auto;
      transition: opacity 0.25s ease;
    }

    .modal.open { display:flex; opacity:1; }

    .modal-content{
      background:#fff;
      border-radius:var(--radius);
      max-width:600px;
      width:100%;
      padding:24px;
      box-shadow:0 12px 36px rgba(0,0,0,0.16);
      animation: scaleUp 0.25s ease forwards;
    }

    @keyframes scaleUp { from{transform:scale(0.95);opacity:0;} to{transform:scale(1);opacity:1;} }

    .close{
      float:right;
      cursor:pointer;
      font-weight:bold;
      border:0;
      background:transparent;
      font-size:1.2rem;
    }

    .btn{
      padding:10px 16px;
      border-radius:8px;
      border:0;
      background:var(--accent);
      color:#fff;
      cursor:pointer;
      font-weight:600;
    }

    .btn:focus{outline:3px solid rgba(0,102,204,0.14);outline-offset:3px;}

    .event-group {
      margin: 12px 0;
      border-top:1px solid #eee;
      padding-top:12px;
    }

    .event-label {
      display:flex;
      justify-content:space-between;
      font-weight:600;
      cursor:pointer;
      margin-bottom:4px;
    }

    .event-description {
      font-size:0.85rem;
      color:#555;
      line-height:1.3;
      margin-bottom:6px;
    }

    /* Decline styling */
    .decline-row label {
      color:#b00;
      font-weight:700;
    }

    /* Tooltip for disabled checkboxes */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      width: 220px;
      background-color: rgba(0,0,0,0.8);
      color:#fff;
      text-align:center;
      border-radius:4px;
      padding:6px 8px;
      position:absolute;
      z-index:10;
      bottom:125%;
      left:50%;
      transform:translateX(-50%);
      opacity:0;
      transition:opacity 0.2s;
      font-size:0.8rem;
      pointer-events:none;
    }

    .tooltip .tooltip-text::after {
      content:"";
      position:absolute;
      top:100%;
      left:50%;
      margin-left:-5px;
      border-width:5px;
      border-style:solid;
      border-color:#333 transparent transparent transparent;
    }

    .tooltip.disabled:hover .tooltip-text {
      visibility: visible;
      opacity:1;
    }

    footer{margin-top:20px;font-size:0.85rem;color:#666;}

        /* Accordion button styling */
        .collapsible {
            font-size: 1rem;
            font-weight: 600;
            color: #222;
            background: #f5f5f5;
            border: none;
            padding: 10px 16px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 4px;
            transition: background 0.2s ease, transform 0.15s ease;
        }

            .collapsible:hover {
                background: #e6f0ff;
                transform: translateY(-1px);
            }

            /* Active state for accordion button */
            .collapsible.active {
                background: #d9eaff;
            }

        /* Content panel */
        .content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0 16px;
            margin-bottom: 12px;
            background: #fafafa;
            border-radius: 0 0 8px 8px;
        }

            /* When active, set max-height large enough to fit content */
            .content.active {
                max-height: 1000px; /* adjust if your content is longer */
                padding-top: 10px;
                padding-bottom: 10px;
            }

        /* Event items */
            /* Divider between options, but NOT above the first one */
            .content .event-group {
                border-top: 1px solid #eee; /* subtle divider */
                padding-top: 6px; /* space above content */
                margin-top: 6px; /* space between items */
            }

                /* Remove divider for the first event in the panel */
                .content .event-group:first-child {
                    border-top: none;
                    padding-top: 0;
                    margin-top: 0;
                }


        .event-label {
            font-weight: 500;
        }

        .event-description {
            font-size: 0.85rem;
            color: #555;
            margin-left: 12px;
        }

        /* Decline message */
        #declineMsg {
            font-size: 0.9rem;
            color: #b00;
            font-style: italic;
            margin-bottom: 12px;
        }


    </style>
</head>
<body>
    <div class="page">
        <div class="overlay" role="article">
            <h1>Einladung | Invitation</h1>
            <div class="subtitle">Christiane & John</div>
            <div class="section">
                Wir möchten mit euch feiern<br><span class="italic">We would like to celebrate with you</span>
            </div>
            <div class="section">
                Wann? | When?<br>27. Juni 2026 um 15:00 Uhr<br><span class="italic">27 June 2026 from 3:00pm</span>
            </div>
            <div class="section">
                Wo? | Where?<br>Zeppelinstrasse 20, Kemnat, Deutschland<br><span class="italic">Zeppelinstrasse 20, Kemnat, Germany</span>
            </div>
            <div class="section">
                <a class="link" href="#">Weitere Informationen | Further Information</a>
            </div>
            <div class="section">
                <p class="small">Bitte RSVP bis 28. Februar 2026 / Please RSVP by 28th February.</p>
                <button class="rsvp-button" id="openRsvp">RSVP</button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="rsvpModal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="modalTitle">


        <div class="modal-content">
            <button class="close" id="closeModal" aria-label="Close">✕</button>
            <h3 id="modalTitle">Rückmeldung | RSVP — <span id="guestName"></span></h3>
            <p class="small">Bitte wähle die Events, an denen du teilnehmen wirst / Please choose all events you will attend.</p>

            <!-- Persistent decline message -->
            <div id="declineMsg" role="alert"
                 style="display:none; margin-bottom:12px; font-size:0.9rem; color:#b00;">
                Sie haben „Absagen“ gewählt – andere Optionen sind deaktiviert. / You selected “Decline”, other options are disabled. Wir hoffen, dich bald zu sehen!
            </div>


            <form id="rsvpForm">

                <input type="hidden" name="guest" value="">
                <input type="hidden" name="uuid" value="">

                <!-- Friday -->
                <button type="button" class="collapsible">Freitag | Friday</button>
                <div class="content">
                    <div class="event-group">
                        <div class="event-label"><label><input type="checkbox" name="choice" value="friday_day"> Mittag - Experience Esslingen</label></div>
                        <div class="event-description">Freitag 10:30-15:00: Stadtspaziergang, Mittagessen, Sektkellerei | Friday 10:30am-3pm: walking tour, lunch, Sekt cellar</div>
                    </div>
                    <div class="event-group">
                        <div class="event-label"><label><input type="checkbox" name="choice" value="friday_evening"> Abend: Drinks & Dinner</label></div>
                        <div class="event-description">Freitag 16:00-22:00: Getränke & Abendessen | Friday 4-10pm: Drinks & dinner</div>
                    </div>
                </div>

                <!-- Saturday -->
                <button type="button" class="collapsible">Samstag | Saturday</button>
                <div class="content">
                    <div class="event-group">
                        <div class="event-label"><label><input type="checkbox" name="choice" value="saturday_day"> Mittag: Stuttgart Tour</label></div>
                        <div class="event-description">09:00-13:30: TV Tower, Rotenberg Grabkapelle | 9am-1:30pm: TV Tower, Rotenberg crypt</div>
                    </div>
                    <div class="event-group">
                        <div class="event-label"><label><input type="checkbox" name="choice" value="wedding_party"> Abend: Das Fest</label></div>
                        <div class="event-description">15:00: Das Fest | 3pm: The Party</div>
                    </div>
                </div>

                <!-- Sunday -->
                <button type="button" class="collapsible">Sonntag | Sunday</button>
                <div class="content">
                    <div class="event-group">
                        <div class="event-label"><label><input type="checkbox" name="choice" value="sunday_breakfast"> Morgen: Weißwurst Frühstück</label></div>
                        <div class="event-description">10:30: Traditionelles Frühstück | 10:30am: Traditional breakfast</div>
                    </div>
                </div>

                <!-- Decline option -->
                <div class="event-group decline-row">
                    <label><input type="checkbox" name="choice" value="decline"> Wir müssen leider absagen | We must unfortunately decline</label>
                </div>

                <!-- Optional message -->
                <div class="radio-row">
                    <label for="message">Nachricht / Message (optional)</label>
                    <textarea id="message" name="message" rows="3" style="width:100%;margin-top:6px"
                              placeholder="Allergien, Kommentare, Fragen … / Allergies, comments, questions …"></textarea>
                </div>

                <div style="margin:12px 0;text-align:right">
                    <button type="button" class="btn" id="submitRsvp">Senden / Send</button>
                </div>

                <div id="responseMsg" style="margin-top:10px;font-size:0.95rem" aria-live="polite"></div>
            </form>

        </div>
    </div>

    <script>
       // const openBtn = document.getElementById('openRsvp');
        const modal = document.getElementById('rsvpModal');
        const close = document.getElementById('closeModal');
        const submitBtn = document.getElementById('submitRsvp');
        const guestName = document.getElementById('guestName');

        let lastFocused = null;

        function openModal() {
            lastFocused = document.activeElement;
            modal.setAttribute('aria-hidden', 'false');
            modal.classList.add('open');
            const guest = document.querySelector('input[name="guest"]')?.value || guestName.textContent;
            guestName.textContent = guest;
            const first = modal.querySelector('input[name="choice"]');
            (first || close).focus();
        }

        function closeModal() {
            modal.setAttribute('aria-hidden', 'true');
            modal.classList.remove('open');
            if (lastFocused) lastFocused.focus();
        }
        window.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);

            const guest = params.get("guest");
            const uuid = params.get("uuid");

            if (!guest || !uuid) {
                document.body.innerHTML = "Ungültiger Einladungslink / Invalid invitation link.";
                return;
            }

            const guestInput = document.querySelector('input[name="guest"]');
            const uuidInput = document.querySelector('input[name="uuid"]');
            const guestNameSpan = document.getElementById('guestName');

            guestInput.value = guest;
            uuidInput.value = uuid;
            guestNameSpan.textContent = guest;

            openModal();
        });
        //openBtn.addEventListener('click', openModal);
        close.addEventListener('click', closeModal);
        window.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

        // Accordion: only one open at a time
        const collapsibles = document.querySelectorAll('.collapsible');

        collapsibles.forEach(btn => {
            btn.addEventListener('click', () => {
                collapsibles.forEach(other => {
                    if (other !== btn) {
                        other.classList.remove('active');
                        const panel = other.nextElementSibling;
                        panel.style.maxHeight = null;
                        panel.classList.remove('active');
                    }
                });

                btn.classList.toggle('active');
                const content = btn.nextElementSibling;
                if (btn.classList.contains('active')) {
                    content.classList.add('active');
                    content.style.maxHeight = content.scrollHeight + "px";
                } else {
                    content.classList.remove('active');
                    content.style.maxHeight = null;
                }
            });
        });


        
        // --- Decline logic & RSVP submit combined ---
        const form = document.getElementById('rsvpForm');
        const checkboxes = form.querySelectorAll('input[type="checkbox"][name="choice"]');
        const declineCheckbox = form.querySelector('input[value="decline"]');
        const declineMsg = document.getElementById('declineMsg');
        const responseMsg = document.getElementById('responseMsg');
        //const submitBtn = document.getElementById('submitRsvp');
        const webhook = 'https://hook.eu1.make.com/ogo298qdbjnukietu5mj3qbumia7fcsj'; // <-- replace with your webhook

        // Decline disables other checkboxes
        checkboxes.forEach(cb => {
            cb.addEventListener('change', () => {
                if (declineCheckbox.checked) {
                    checkboxes.forEach(c => { if (c !== declineCheckbox) { c.checked = false; c.disabled = true; } });
                    declineMsg.style.display = 'block';
                } else {
                    checkboxes.forEach(c => { if (c !== declineCheckbox) { c.disabled = false; } });
                    declineMsg.style.display = 'none';
                }
            });
        });

        // RSVP submit handler
        submitBtn.addEventListener('click', () => {
            responseMsg.textContent = ''; // clear previous messages

            // Ensure guest and uuid inputs exist
            const guestInput = form.querySelector('input[name="guest"]');
            const uuidInput = form.querySelector('input[name="uuid"]');
            if (!guestInput || !uuidInput) {
                responseMsg.textContent = 'Fehler: fehlende Gast- oder UUID-Daten / Missing guest or UUID fields.';
                responseMsg.style.color = '#b00';
                return;
            }

            // Collect event checkbox states
            const EVENT_KEYS = [
                'friday_day', 'friday_evening', 'saturday_day', 'wedding_party', 'sunday_breakfast', 'decline'
            ];
            const events = {};
            EVENT_KEYS.forEach(key => {
                events[key] = !!form.querySelector(`input[value="${key}"]:checked`);
            });

            // Require at least one selection
            const anySelected = Object.values(events).some(Boolean);
            if (!anySelected) {
                responseMsg.textContent = 'Bitte wähle mindestens eine Option / Please choose at least one option.';
                responseMsg.style.color = '#b00';
                return;
            }

            const guest = guestInput.value.trim();
            const uuid = uuidInput.value.trim();
            const message = form.querySelector('textarea[name="message"]')?.value.trim() || '';

            let rsvp_status = 'none';
            if (events.decline) {
                rsvp_status = 'declined';
            } else if (Object.values(events).some((val, idx) => idx < EVENT_KEYS.length - 1 && val)) {
                // Any non-decline checkbox selected
                rsvp_status = 'accepted';
            }

            const payload = {
                uuid: uuid,
                name: guest,
                friday_day: events.friday_day,
                friday_evening: events.friday_evening,
                saturday_day: events.saturday_day,
                wedding_party: events.wedding_party,
                sunday_breakfast: events.sunday_breakfast,
                decline: events.decline,
                rsvp_status: rsvp_status,
                message: message,
                timestamp: new Date().toISOString(),
                source: window.location.href || 'local-file'
            };

            submitBtn.disabled = true;
            submitBtn.textContent = 'Senden… / Sending…';

            fetch(webhook, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
                .then(() => {
                    responseMsg.textContent = 'Danke — Eure Antwort wurde gesendet. / Thank you — your response has been sent.';
                    responseMsg.style.color = 'green';
                    setTimeout(() => {
                        closeModal();
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Senden / Send';
                        form.reset();
                    }, 3000);
                })
                .catch(err => {
                    responseMsg.textContent = 'Danke — aber ein Fehler ist passiert. Bitte kontaktiere Christiane oder John.';
                    responseMsg.style.color = '#b00';
                    console.error(err);
                    setTimeout(() => {
                        closeModal();
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Senden / Send';
                    }, 3000);
                });
        });

    </script>
</body>
</html>
